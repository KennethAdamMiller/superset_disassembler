apiVersion: v1
kind: Service
metadata:
  name: broker-${TAG}
spec:
  containers:
    - image: superset_disasm_flambda:${TAG}
      command: python3 scripts/distributor.py
      volumeMounts:
      - name: x86_64-binaries
        mountPath: /home/opam/workspace/x86_64-binaries
      - name: x86-binaries
        mountPath: /home/opam/workspace/x86-binaries
      - name: arm-binaries
        mountPath: /home/opam/workspace/arm-binaries
  volumes:
    - name: x86_64-binaries
      hostPath: ${HOME}/workspace/x86_64-binaries/
    - name: x86-binaries
      hostPath: ${HOME}/workspace/x86-binaries/
    - name: arm-binaries
      hostPath: ${HOME}/workspace/arm-binaries/
  ports:
    - name: service
      protocol: TCP
      port: 9999
      targetPort: 9999
    - name: collector
      protocol: TCP
      port: 9998
      targetPort: 9998
    - name: killed
      protocol: TCP
      port: 9997
      targetPort: 9997
    - name: cache_transfer
      protocol: TCP
      port: 9996
      targetPort: 9996